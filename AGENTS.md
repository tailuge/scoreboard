# Scoreboard Project Guide for Gemini Agents

This project is a scoreboard and lobby system for the [tailuge/billiards](https://github.com/tailuge/billiards) game. It is designed to run on Vercel and uses real-time communication via Nchan.

## Tech Stack

- **Framework**: Next.js (using the `pages` router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS, Framer Motion, Heroicons
- **Database/Storage**: Vercel KV (@vercel/kv / Redis)
- **Real-time**: Nchan (external server, configuration in `src/nchan`)
- **Testing**: Jest (Unit/Integration) and Playwright (E2E)
- **Formatting/Linting**: Prettier, ESLint

## Directory Structure

- `src/pages`: Contains Next.js pages and API routes (`src/pages/api`).
- `src/services`: Business logic and service layers for interacting with KV and other external services.
- `src/components`: Reusable React components.
- `src/nchan`: Configuration and utilities for Nchan (pub/sub).
- `src/utils`: Common utility functions.
- `src/tests`: Test configurations and files.
- `public`: Static assets and standalone HTML pages (e.g., `leaderboard.html`, `test.html`).

## Key Workflows

### dev

```shell
yarn dev
yarn start
yarn build
yarn deps
yarn prettify
```

### lint

```shell
yarn lint
yarn lint:smells
```

### test

```shell
yarn test
yarn coverage
yarn e2e
yarn e2e:headed
yarn e2e:local
```

### docker

```shell
yarn docker:build
yarn docker:push
```

## Important Notes for Agents

1. **Experimental Nature**: Much of this codebase was generated by various LLMs. You may encounter inconsistent patterns or "untangled" logic.
2. **Backend**: The project heavily relies on Vercel KV. Local development might use `ioredis-mock` for testing, but real functionality requires KV credentials.
3. **Hybrid Pages**: Some functionality is in Next.js React pages, while other parts are in static HTML files in the `public` directory.
4. **Nchan**: Real-time updates (like lobby status) are handled via Nchan. See `src/nchan` for implementation details.
5. **Testing**: Always run `yarn test` after completing a task to ensure no regressions were introduced.
6. **`globalThis`**: Always use `globalThis` instead of environment-specific globals like `window`, `global`, or `self`. Before submitting, search the codebase for any instances of these to ensure code portability.

## Common Tasks
- **Adding an API route**: Add a new file in `src/pages/api`.
- **Modifying styles**: Uses Tailwind CSS. Check `tailwind.config.ts`.
- **Updating Score Logic**: Primarily handled in `src/services/scoretable.ts` and `src/services/TableService.ts`.
